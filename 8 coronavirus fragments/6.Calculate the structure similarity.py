
utr_sequences = General.load_fasta('/Share2/home/zhangqf7/lipan/SARS2/Target-icSHAPE-MaP/sequences/utr_sequences.fa')

subseq5 = {}
subseq5['MERS'] = utr_sequences['MERS'][:460]
subseq5['SARS'] = utr_sequences['SARS'][:395]
subseq5['SARS2-C'] = utr_sequences['SARS2-C'][:395]
subseq5['SARS2-T'] = utr_sequences['SARS2-T'][:395]
subseq5['bHKU5'] = utr_sequences['bHKU5'][:445]
subseq5['bHKU9'] = utr_sequences['bHKU9'][:330]
subseq5['hHKU1'] = utr_sequences['hHKU1'][:330]
subseq5['hNL63'] = utr_sequences['hNL63'][:330]

subseq3 = {}
subseq3['MERS'] = utr_sequences['MERS'][-290:]
subseq3['SARS'] = utr_sequences['SARS'][-330:]
subseq3['SARS2-C'] = utr_sequences['SARS2-C'][-330:]
subseq3['SARS2-T'] = utr_sequences['SARS2-T'][-330:]
subseq3['bHKU5'] = utr_sequences['bHKU5'][-290:]
subseq3['bHKU9'] = utr_sequences['bHKU9'][-265:]
subseq3['hHKU1'] = utr_sequences['hHKU1'][-200:]
subseq3['hNL63'] = utr_sequences['hNL63'][-300:]

structures5 = {
    'MERS':   '.....(((((((((((...))))).))))))......(((((.....))))).(((.......)))............((((.(.((((.(((((((.(((.((((.((((((((((.....((((......))))..)))))).)))))))))))))))))).))))).)))).....................(((((((...((((((..((.(((..(((((((((((((((..(((.(((......)))))).)))))....)))).(((((((.(((......))))))))))(((((((.......))))))))))))).)))))))))))....))))))).......(((((.((.((.....(((.(((((...))))).))))).)).)))))......((((((((((..((((((...((((....)))))))))))))))))))).',
    'SARS':   '......(((((((.(((....))))))))))..........(((((.....))))).((((.......))))........((((((((.((.((((.(((.....))).)))))).))))))))........................((((((((((((.(((((...(((.(((.(((((((..((((((.(((((......)))))..))))))......)))(((((((.((......)))))))))(((....))))))).)))))).))))))))))...))))))).......((((((....((.....(((((.....)))))..)))))))).....(((((.((((((((.((((.....)))).)))...))))).)))))..',
    'SARS2-C':  '......(((((.(((((....)))))..)))))...........(((((.....))))).((((.......))))........((((((((.((.((((.(((.....))).)))))).))))))))......................(((((((((((..(((((...(((.(((((((((((..((((((.(((((......)))))..))))))......)))(((((((.((......)))))))))(((....)))))))))))))).))))).))))...))))))).......((((((.(((...))).((((((...))))))....)))))).....(((((.(((((((((((((.....)))).))))..))))).))))).',
    'SARS2-T': '......(((((.(((((....)))))..)))))...........(((((.....))))).((((.......))))........((((((((.((.((((.(((.....))).)))))).))))))))......................(((((((((((..(((((...(((.(((((((((((..((((((.(((((......)))))..))))))......)))(((((((.((......)))))))))(((....)))))))))))))).))))).))))...))))))).......((((((.(((...))).((((((...))))))....)))))).....(((((.(((((((((((((.....)))).))))..))))).))))).',
    'bHKU5':  '......((((.(((((...)))))..)))).....(((((.....))))).(((((...)))))............((((...((((.(((((((.((....((..((((..(((((...)))))))))..))...))))))))).))))..)))).....................((((((((..(((..((.((.(((..(((((((((((((((..(((.(((......)))))).)))))....).)))(((((((.(((......))))))))))(((((((.......))))))))))))).))))))).)))...)))))))).......(((((...((((((....(((((((...))))))).)))))).)))))........(((((.(((.((((((...((((....))))))))))))))))))......',
    'bHKU9':  '.......(((.(((((.....))))).)))...............(((((.....)))))(((....))).............((((...((((.(((((((((......)))))))))))))...))))..............((((((...(((((.((((..(((((..((.(((((((((......))))).)))).)).((((((((......))))))))....)).))).)))).))))).....))))))..............(((((((....)))))))..............((((((((.......))))))))...',
    'hHKU1':  '.....((((((((.((((.......)))).))).))))).(((((......)))))......................((((((((.........(((((((....))))))).........))))))))..................(((((((....(((.((....((((((((....((((((.((........)).)))..)))....))))))))...)))))...(((((((...(((((((((...(((.((.(((((........))))).)).))))))))..))))..)))))))))))))).................',
    'hNL63':  '....(((((.(((((((((....)))))))))..)))))...(((((.....)))))..........((..(((((((((..((((.((((((((.....)))))))).))))........)))))))))..)).(((((.((((((((.(((.((((((.......(((((....((((((((((......)))))))))))))))........(((((((((......)))))))))..((....((((((......))))))....))))))).)))))))))).))..))))).....((((((((((....)))))))..)))..'
}

structures3 = {
    'MERS':   '.....(((((....(((((.((...(((..(((.....)))...)))...)).)))))...)))))................(((((((((((...........))))))))))).........((((((((((..((((((...((.....(((((((..............((((((((...(((......))).))).))))).(((...))).......))))))).....))...))))))..)))))))))).((((((((......)))))).))........',
    'SARS':   '.......(((((((..(.(((((((((((..(((...((......))...))).)))))))))))))))))))...............(((((((((.((....))..)))))))))...((((..(((((.((((..((..(((.(((.....(((((((((.((.(((....))))).((.(((((((((....(((.((((.....))..))..)))...))))).))))...)).....((.((.....)).))..))))))))).....))).)))..))...)))).......)))))..))))....................',
    'SARS2-C':  '.......((((((..((.(((((((((((..(((...((......))...))).)))))))))))))))))))...............(((((((((.((....))..))))))))).((((((..((((.(((((..((..(((.(((.....(((((((((.((.(((....))))).((.(((((((((....((.((.((.........)).))))...))))).)))).((((........))))...)).....))))))))).....))).)))..))...))))).......))))..)))).)).................',
    'SARS2-T': '.......((((((..((.(((((((((((..(((...((......))...))).)))))))))))))))))))...............(((((((((.((....))..))))))))).((((((..((((.(((((..((..(((.(((.....(((((((((.((.(((....))))).((.(((((((((....((.((.((.........)).))))...))))).)))).((((........))))...)).....))))))))).....))).)))..))...))))).......))))..)))).)).................',
    'bHKU5':  '...(((((((...((((((.((..((((..(((.....)))..))))...)).)))))).)))))))................(((.(((((((...........))))))))))...........((((((((..((((......((.....(((((((..............((((((((...((((....)))).))).))))).(((...))).......))))))).....))......))))))))))))...(((..((((........))))..))).....',
    'bHKU9':  '.....(((((.(((.((((((((((..((((....))))..))))))).))).))).))))).................((((.((((((((((...........)))))))))).((((((.(((((((((((((...((.(((((...((((((((((((((................))).))..........)))))))))....))))).))...)))))))).....))))).))))))............))))....',
    'hHKU1':  '...((((((((((..(.....)..)))))))))).............((((..((((((((((.(((((((......))))....))).)))))))))).))))...........(((((((.(((.(((((.(((((..((.((((((((((((....))))))).)))))))))))))))))))))))))))......',
    'hNL63':  '......((((((((.(((((...(((....))))))))))))))))..........((((((((((((...)))))))....))))).........................(((((((((((..........)))))))))))(((((((.(((((((.......(((((((((((.....(((((((((((.............(((......)))((......)).....)))))))))))...))))).))))))))))).)).))))))).(((((......)))))........',
}

utr5_score_df = General.init_pd_rect(8, 8, keys, keys, 1)
utr3_score_df = General.init_pd_rect(8, 8, keys, keys, 1)
for i in range(8):
    print(i)
    for j in range(i+1, 8):
        seqdot1 = [subseq5[keys[i]], structures5[keys[i]]]
        seqdot2 = [subseq5[keys[j]], structures5[keys[j]]]
        ##### 这里设置的参数故意忽略序列的影响
        score = Structure.calc_structure_similarity(seqdot1, seqdot2, pm=10, pd=-5, bm=0, br=0, bd=0, mode='score', verbose=False)
        utr5_score_df.iloc[i, j] = utr5_score_df.iloc[j, i] = score
        
        seqdot1 = [subseq3[keys[i]], structures3[keys[i]]]
        seqdot2 = [subseq3[keys[j]], structures3[keys[j]]]
        score = Structure.calc_structure_similarity(seqdot1, seqdot2, pm=10, pd=-5, bm=0, br=0, bd=0, mode='score', verbose=False)
        utr3_score_df.iloc[i, j] = utr3_score_df.iloc[j, i] = score

utr5_score_df
utr3_score_df

plt.figure(figsize=(7,6))
sns.heatmap(utr5_score_df, cmap="YlGnBu",  annot=True, fmt='.3f')
plt.tight_layout()
plt.savefig(join(HOME, 'figs/structure_similarity_5p.pdf'))
plt.close()

plt.figure(figsize=(7,6))
sns.heatmap(utr3_score_df, cmap="YlGnBu",  annot=True, fmt='.3f')
plt.tight_layout()
plt.savefig(join(HOME, 'figs/structure_similarity_3p.pdf'))
plt.close()


